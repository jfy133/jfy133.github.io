<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
  <!--<![endif]-->
  <head>
  <title>James A. Fellows Yates</title>

  <!-- Meta -->
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Personal website and CV for James A. Fellows Yates">

  <!-- Favicon -->
  <link rel="shortcut icon" href="favicon.ico">

  <!-- Global CSS -->
  <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css">

  <!-- Plugins CSS -->
  <link rel="stylesheet" href="/assets/plugins/font-awesome/css/all.css">

  <!-- Theme CSS -->
  <link id="theme-style" rel="stylesheet" href="/assets/css/main.css">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

  <body>
    <div class="wrapper">
      
<div class="sidebar-wrapper">

  <div class="profile-container">

    
    <img class="avatar" src="/assets/images/profile.png" alt="profile picture" />
    

    
    <h1 class="name">Dr. James A. Fellows Yates</h1>
    

    
    <h3 class="tagline">Post Doctoral Bioinformaician</h3>
    

  </div><!--//profile-container-->

  <div class="contact-container container-block">
  <ul class="list-unstyled contact-list">

    
    <li class="email"><i class="fas fa-envelope"></i>
      <a href="mailto:jfy133@gmail.com">jfy133@gmail.com</a>
    </li>
    

    

    

    
    <li class="timezone"><i class="fas fa-clock"></i>
      <a href="">Central European Time</a>
    </li>
    

    

    
    <li class="website"><i class="fas fa-globe-americas"></i>
      <a href="http://jafy.eu" target="_blank">jafy.eu</a>
    </li>
    

    
    <li class="linkedin"><i class="fab fa-linkedin"></i>
      <a href="https://linkedin.com/in/james-fellows-yates-999859179" target="_blank">james-fellows-yates-999859179</a>
    </li>
    

    

    
    <li class="github"><i class="fab fa-github"></i>
      <a href="http://github.com/jfy133" target="_blank">jfy133</a>
    </li>
    

    

    

    
    <li class="twitter"><i class="fab fa-twitter"></i>
      <a href="https://twitter.com/@jfy133" target="_blank">@jfy133</a>
    </li>
    

    

    

    

    

  </ul>
</div><!--//contact-container-->


  
    

  
  <div class="education-container container-block">

    <h2 class="container-block-title">
      Education
    </h2>

    
    <div class="item">
      <h4 class="degree">PhD in Bioinformatics</h4>
      <h5 class="meta">Friedrich-Schiller-Universität Jena (Max Planck Institute for the Science of Human History / Max Planck Institute for Evolutionary Anthropology, 🇩🇪)</h5>
      <div class="time">2015 - 2022</div>
    </div><!--//item-->
    
    <div class="item">
      <h4 class="degree">MSc in Naturwissenschaftliches Archäologie</h4>
      <h5 class="meta">Eberhard-Karls-Universität Tübingen (🇩🇪)</h5>
      <div class="time">2013 - 2015</div>
    </div><!--//item-->
    
    <div class="item">
      <h4 class="degree">BSc (Hons) in Biomolecular Archaeology</h4>
      <h5 class="meta">University of York (🇬🇧)</h5>
      <div class="time">2010 - 2013</div>
    </div><!--//item-->
    

  </div><!--//education-container-->
  


  

  

<div class="languages-container container-block">

  <h2 class="container-block-title">
    Languages
  </h2>

  <ul class="list-unstyled interests-list">
    
    <li>
      English
      <span class="lang-desc">(Native)</span>
    </li>
    
    <li>
      German
      <span class="lang-desc">(B2)</span>
    </li>
    
    <li>
      Spanish
      <span class="lang-desc">(Basic)</span>
    </li>
    
    <li>
      Catalan
      <span class="lang-desc">(Basic)</span>
    </li>
    
  </ul>

</div><!--//interests-->


  



  
    <div class="remove-container container-block">
  <h2 class="container-block-title">
    About Theme
  </h2>
  <ul class="list-unstyled interests-list">
    <li><a target="_blank" href="https://www.youtube.com/watch?v=Jnmj1dXDbNk">How to use?</a></li>
     <li><a class="github-button" href="https://github.com/sharu725/online-cv" data-icon="octicon-star" data-show-count="true" aria-label="Star sharu725/online-cv on GitHub">Star</a>
     <script async defer src="https://buttons.github.io/buttons.js"></script>
  </ul>
</div><!--//About-->
  

</div><!--//sidebar-wrapper-->


      <div class="main-wrapper"><h1 id="tidy-pop-gen-pca-plotting-in-r">‘Tidy’ Pop-Gen PCA plotting in R</h1>

<h3 id="james-a-fellows-yates">James A. Fellows Yates</h3>

<p>I recently was using the R package <a href="http://stat.sys.i.kyoto-u.ac.jp/prog/pvclust/"><code class="language-plaintext highlighter-rouge">pvclust</code></a> to test the
‘robusticity’ of clusters in a microbiome-related clustering analysis. While <code class="language-plaintext highlighter-rouge">pvclust</code> provides it’s own plots via <code class="language-plaintext highlighter-rouge">plot()</code> on a <code class="language-plaintext highlighter-rouge">pvclust</code> object, this plots the dendrogram in base R. For readability and customisability reasons I prefer using the packages <code class="language-plaintext highlighter-rouge">ggplot2</code> and <code class="language-plaintext highlighter-rouge">ggtree</code> for making my figures. However, I was having a hard time to extract the node uncertainty values from the <code class="language-plaintext highlighter-rouge">pvclust</code> object and integrate them into a generic R <code class="language-plaintext highlighter-rouge">phylo</code> object for plotting the dendrogram in ggtree.</p>

<p>Fortunately, a bit of googling (a couple of days…) showed me someone else had already solved the problem of transferring additional <code class="language-plaintext highlighter-rouge">hclust</code> information into a <code class="language-plaintext highlighter-rouge">phylo</code> object but in a different context. The <code class="language-plaintext highlighter-rouge">fastbap</code> package has the function <a href="https://github.com/gtonkinhill/fastbaps/blob/master/R/as.phylo.hclust.node.attributes.R"><code class="language-plaintext highlighter-rouge">as.phylo.hclust.node.attributes()</code></a> which essentially does what I needed to do - i.e. when calculating the node numbers from each merge event, also store with the same node number the corresponding attribute, or in this case,<code class="language-plaintext highlighter-rouge">pvclust</code> AU value.</p>

<p>I then modified this function slightly to make it more consistent with how <code class="language-plaintext highlighter-rouge">pvclust</code> will display the values in the base R plot (rounding and converting to a ‘percentage’). Note that this outputs in the <code class="language-plaintext highlighter-rouge">phylo</code> object the metadata <code class="language-plaintext highlighter-rouge">node.label</code>, not as <code class="language-plaintext highlighter-rouge">node.attributes</code> as in the original <code class="language-plaintext highlighter-rouge">fastbaps</code> function.</p>

<p>So in summary:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## 1. Make pvclust object e.g.</span><span class="w">
</span><span class="n">hclust_boot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pvclust</span><span class="o">::</span><span class="n">pvclust</span><span class="p">(</span><span class="n">otu_matrix</span><span class="p">,</span><span class="w">
                 </span><span class="n">method.hclust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">selected_method</span><span class="p">,</span><span class="w">
                 </span><span class="n">method.dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"euclidean"</span><span class="p">,</span><span class="w">
                 </span><span class="n">nboot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w">
                 </span><span class="n">parallel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1">## 2. Set modified fastbaps function</span><span class="w">
</span><span class="n">as.phylo.pvclust.node.attributes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">attribute</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">merge</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
  </span><span class="n">edge</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">0L</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
  </span><span class="n">edge.length</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">numeric</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">N</span><span class="p">)</span><span class="w">
  </span><span class="c1">## `node' gives the number of the node for the i-th row of x$merge</span><span class="w">
  </span><span class="n">node</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">integer</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w">
  </span><span class="n">node</span><span class="p">[</span><span class="n">N</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2L</span><span class="w">
  </span><span class="n">node.attributes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w">
  </span><span class="n">cur.nod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">3L</span><span class="w">
  </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1L</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">N</span><span class="o">:</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">edge</span><span class="p">[</span><span class="n">j</span><span class="o">:</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1L</span><span class="w">
      </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">merge</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">]</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">edge</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">node</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cur.nod</span><span class="w">
        </span><span class="n">cur.nod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cur.nod</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1L</span><span class="w">
        </span><span class="n">edge.length</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">height</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">height</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="w">
        </span><span class="n">node.attributes</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">attribute</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">edge</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">-</span><span class="n">y</span><span class="w">
        </span><span class="n">edge.length</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">height</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
        </span><span class="n">node.attributes</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w">  </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">attribute</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">2L</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">labels</span><span class="p">))</span><span class="w">
    </span><span class="n">x</span><span class="o">$</span><span class="n">labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">

  </span><span class="c1">## MODIFICATION: clean up node.attributes so they are in same format in</span><span class="w">
  </span><span class="c1">## pvclust plots</span><span class="w">
  </span><span class="n">node.attributes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">node.attributes</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
  </span><span class="n">node.attributes</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">

  </span><span class="n">obj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edge</span><span class="p">,</span><span class="w"> </span><span class="n">edge.length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edge.length</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
              </span><span class="n">tip.label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">labels</span><span class="p">,</span><span class="w"> </span><span class="n">Nnode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">node.label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node.attributes</span><span class="p">)</span><span class="w">
  </span><span class="nf">class</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"phylo"</span><span class="w">
  </span><span class="n">stats</span><span class="o">::</span><span class="n">reorder</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1">## 3. Use the modified fastbaps function by accessing the hclust object in first</span><span class="w">
</span><span class="c1">## position, and the corresponding au values from the edges list entry.</span><span class="w">
</span><span class="n">hclust_boot_phylo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.phylo.pvclust.node.attributes</span><span class="p">(</span><span class="n">hclust_boot</span><span class="o">$</span><span class="n">hclust</span><span class="p">,</span><span class="w">
                                                     </span><span class="n">hclust_boot</span><span class="o">$</span><span class="n">edges</span><span class="o">$</span><span class="n">au</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<p>To display the values on the tree with <code class="language-plaintext highlighter-rouge">ggtree</code> you can then run</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggtree</span><span class="p">(</span><span class="n">hclust_boot_phylo</span><span class="w">  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_text2</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">subset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isTip</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">label</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>as described in the <code class="language-plaintext highlighter-rouge">ggtree</code> <a href="https://guangchuangyu.github.io/software/ggtree/faq/#">FAQ</a> under the section “bootstrap values from newick format”.</p>
</div>
    </div>

    <footer class="footer">
    <div class="text-center">
        <!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can check out other license options via our website: themes.3rdwavemedia.com */-->
        <small class="copyright">Designed with <i class="fas fa-heart"></i> by <a href="http://themes.3rdwavemedia.com" target="_blank" rel="nofollow">Xiaoying Riley</a>. Contents ©️ James A. Fellows Yates, 2022
</small>
    </div><!--//container-->
</footer><!--//footer-->
 <!-- Javascript -->
<script
  type="text/javascript"
  src="/assets/plugins/jquery-1.11.3.min.js"
></script>
<script
  type="text/javascript"
  src="/assets/plugins/bootstrap/js/bootstrap.min.js"
></script>

<!-- custom js -->
<script
  type="text/javascript"
  src="/assets/js/main.js"
></script>

<!--  -->

  </body>
</html>
